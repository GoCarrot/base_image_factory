---
- hosts: all
  become: yes

  tasks:
    - name: Cleanup temp files
      file:
        path: "{{ item }}"
        state: absent
      with_items:
        - /var/cache/
        - /var/lib/apt/
        - /var/log/apt/
        - /etc/mailname
        - /var/lib/cloud
        - /var/lib/chrony
        - /var/lib/teak-log-collector/
        - /var/log/teak-log-collector/
        - /root/.bash_history
        - /root/.ssh/
        - /root/.ansible/
        - /root/.bundle/
        - /etc/machine-id
        - /var/lib/dbus/machine-id

    - name: Cleanup log files
      shell: find /var/log -type f | xargs rm

    - name: Shred hostkeys
      shell: shred --remove /etc/ssh/ssh_host_*

    - name: Remove resolv.conf
      shell: if [ ! -L /etc/resolv.conf ]; then rm /etc/resolv.conf; fi

    - name: Touch machine-id
      shell: touch /etc/machine-id
